Walmart is facing a "perfect storm" that's hurting its sales growth, according to Moody's.

The company's core customers are struggling with flat income levels, and savings from lower fuel pricesaren't translating into more retail spending, Moody's vice president, Charles O'Shea, wrote in a note to clients on Wednesday.

Related: Why Bad News for Walmart Is Good News for Small Town, USA

The business is also under pressure from deflation in key product categories, such as food, and the effects of the strong dollar abroad.

"Walmart is facing an almost perfect storm when it comes to top-line growth," O'Shea wrote. "Until the health of the lower-to-middle-income consumer improves, Walmart will continue to face macroeconomic headwinds in the US."

Walmart said last month that it's expecting virtually no sales growth in the coming fiscal year. The company had previously projected growth of 3% to 4% for the year, but lowered its guidance last month citing the impact of the strengthening US dollar. The company's share price has lost about 16% of its value over the last 12 months.

Despite its slowing revenue growth, Walmart continues to invest heavily in employee wages and e-commerce in an effort to stay competitive with Amazon.

Related: The Scary Truth Behind Walmartâ€™s Struggles

But the store's online sales growth has started to contract. Online revenue growth slowed to 12% for fiscal year 2016, following 22% growth for the previous year.

That has some investors concerned about Walmart's long-term prospects.

But O'Shea says that Walmart's e-commerce performance is still impressive.

"All in all, a $14-15 billion global online business is more than respectable, especially when it augments a brick-and-mortar business that generates around $470 billion in annual sales," O'Shea wrote.

He said that the stock market "can be unfriendly," and investors are ignoring the long-term benefits of Walmart's e-commerce investments.

"We continue with our thesis that brick-and-mortar retailers that resist the move to at least have representative online businesses will find themselves in a precarious competitive position over the longer term," O'Shea wrote.

To reduce losses, Walmart is closing 269 underperforming stores globally, including 154 in the US. Analysts are expecting even more store closings down the road.

"Future thinning of the herd will occur at some point as more of the business moves online," O'Shea wrote.

This article originally appeared on Business Insider. Read more from Business Insider:

The VW boss who famously apologized to America has left the company

WeWork is raising a massive $780 million round to become a $17 billion company

Silicon Valley's most secretive startup won't sell to tobacco companies