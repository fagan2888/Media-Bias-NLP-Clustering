Alabama lawmakers passed the state budget tonight, possibly ending a six-month stalemate over how to fund state government for the fiscal year that begins in two weeks.

The plan, boosted by a cigarette tax increase and money moved from education, would close most of a projected shortfall in the money going to state agencies.

It goes to Gov. Robert Bentley, who said he would not sign it tonight.

The House passed the budget by a vote of 70-21.

The Senate had passed it earlier tonight by a vote of 23-9.

Both chambers voted to end the special session tonight.

Lawmakers approved about $166 million in new revenue for the General Fund, covering most of a projected $200 million shortfall.

They voted to raise the cigarette tax by 25 cents a pack, generating an estimated $70 million a year, and to move $80 million in use tax revenue from the Education Trust Fund to the General Fund.

New taxes on pharmacies and nursing homes would generate a total of about $16 million a year for Medicaid.

Sen. Arthur Orr, R-Decatur, the Senate budget chairman, said the budget would protect critical state services for the elderly, children, the mentally ill and Medicaid recipients.

It would also provide level-funding for the state court system and for prisons, plus additional money needed for reforms intended to reduce prison crowding.

"All those services being level-funded was a great achievement, I think, by the Legislature, to get that done," Orr said.

Other agencies were generally cut by about 5.5 percent, although that varied, Orr said.

The budget would spend $1.76 billion from the General Fund, a reduction of about $83 million, or 4.5 percent from this year.

Orr said the plan was a "much, much better" than a spending plan that passed during the regular session in June, which Bentley vetoed, and one that failed to pass in the first special session in August.

Those budgets, without new revenue, would have slashed spending by about $200 million.

Many Democrats criticized the Republican-led budget plan, saying that it falls short of the reforms needed to fund state services in the long run.

"We'll be back here next year with the same problem," Rep. John Rogers, D-Birmingham, said. "We haven't done anything to stop the real bleeding."

Most Democrats opposed the tax increases and plan to move money from education that closed much of the budget shortfall.

They have pushed unsuccessfully for a vote on a state lottery and for the governor to expand Medicaid under the Affordable Care Act.

"The Republicans had three options: Cut services, raise taxes or raid the Education Trust Fund," said Rep. Craig Ford, D-Gadsden, the House minority leader. "Somehow or another they did all three in one special session."

Other bills are expected to partly offset the transfer of $80 million in use tax revenue from the ETF to the General Fund.

The Legislature also approved changes to the education budget Rolling Reserve Act that are expected to free up more money for classrooms.

Republicans said the use tax transfer, which is permanent, would also be an important reform because it provides a growing revenue source for the often stagnant General Fund.

Orr said a misunderstanding over what constituted level funding for the Alabama Medicaid Agency required some last-minute adjustments today.

The Senate took about a three-hour recess to revise the budget, adding $16 million to Medicaid from money that was taken from other agencies.

Orr said the money was needed, in part, to enable primary care doctors who see Medicaid patients to continue to receive reimbursement at the higher levels paid by Medicare.

Otherwise, those payments to doctors would have dropped substantially to the Medicaid levels on Oct. 1, likely reducing the number of physicians who treat Medicaid patients and reducing access to care, Orr said.