Christmas lights blink in a handful of restaurants in Tacloban, Philippines, but at nightfall, much of this city flattened by Typhoon Haiyan slips into darkness.

A few downtown shops have reopened. Roadside vendors peddle fruits of the season: oranges and red apples. There is rebuilding, though much of it consists of residents hammering shelters out of scavenged debris.

The Nov. 8 typhoon killed more than 6,100 people in the eastern Philippines, displaced at least 4 million others and left its most gruesome mark on Tacloban, a city of 240,000 that will need years to recover.

Soon after the storm, Philippine Energy Secretary Jericho Petilla promised to restore power by Christmas Eve or resign, and indeed, electricity has returned to nearly all of the more than 300 towns that lost it. But relatively few people are able to use it. Officials say many storm-ravaged houses and shops will spend the holidays in the dark because their wiring systems are damaged.

Here, Christmas will be a celebration amid deprivation, in tents, makeshift homes and damaged churches. The smell of death remains in parts of the city. Thousands of people have simply left.

“Many of them, I know, prefer not to spend it here,” Mayor Alfred Romualdez says. “Maybe a change of scenery first and then come back after the holidays.”

In early November, Eledio Moro thought he had Christmas figured out. He was going to surprise his 2-year-old daughter, Aubrey, with a pink toy motorbike. For his wife, a gold bracelet, or maybe an expensive Western-brand shirt.

He owned a restaurant and a money-lending business. His new house was one of the grandest in the poor coastal neighborhood. Last year, he draped it in the best and brightest Christmas lights.

“We worked hard and were doing well then suddenly, like a bubble that burst, I lost everything,” he says.

Like many in Tacloban, Moro ignored an order from authorities to evacuate as Haiyan approached, thinking his house could withstand the storm.

He and his family were huddled by the staircase when a cargo ship, swept inland by the massive storm surge, smashed into the house, knocking them into the water.

He survived by grabbing a piece of bamboo. Now all that is left of his home is the staircase, a wall and a second-floor balcony beside the huge, steel-hulled ship, still stuck by the road.

Moro, 41, now lives with his sister. Sleeping tablets have helped him get through the worst of the past six weeks, he says.

On Christmas, he will visit the graves of his wife and his daughter, “to ask forgiveness for not having been able to save them.”

At night in Tacloban’s dark and dreary downtown, Joseph Bonavitacola’s restaurant is filled with chatter, mostly of foreign and local aid workers. His brick oven hardly gets any rest.

Red Christmas lanterns, lights and decor adorn window panes and a brick wall at Giuseppe’s, which has the ambiance of fine dining in Manila, the Philippine capital.

It’s hard to imagine how the Italian businessman, who has lived in the city for 20 years with his Filipino wife, reopened the place less than three weeks after Typhoon Haiyan devastated about 4,000 businesses. Only about 5 percent have reopened, officials say.

Frightened by a jailbreak and lootings, he left for Manila with his family but returned after three days to start a massive cleanup with 20 employees. He fixed damaged equipment and got supplies from another branch of his restaurant.

Despite a power outage, he reopened Nov. 24 with candlelit tables.

Outside his crowded restaurant, armed policemen stand guard. Most nearby shops remain shut.

“We try to make it feel as normal as possible,” says Bonavitacola’s wife, Catheryn. “Because outside, it’s still depressing.”